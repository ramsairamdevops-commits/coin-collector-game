<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Kirana Network</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Poppins',sans-serif;margin:0;background:#f4f6f9;}
header{background:linear-gradient(45deg,#1b5e20,#2e7d32);
color:white;padding:15px;text-align:center;font-weight:600;}
.card{background:white;margin:15px;padding:15px;
border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
button{background:#1b5e20;color:white;border:none;
padding:10px;border-radius:8px;width:100%;margin-top:8px;}
input,select{width:100%;padding:10px;margin:6px 0;
border-radius:8px;border:1px solid #ddd;}
.hidden{display:none;}
.status{padding:5px 10px;border-radius:20px;font-size:12px;}
.pending{background:#fff3cd;}
.delivered{background:#d4edda;}
</style>
</head>

<body>

<header>ðŸ›’ Smart Kirana Network</header>

<div class="card">
<h3>Login / Register</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<select id="role">
<option value="customer">Customer</option>
<option value="shop">Shop Owner</option>
<option value="delivery">Delivery Boy</option>
<option value="admin">Admin</option>
</select>
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
</div>

<div id="dashboard" class="hidden">

<!-- SHOP PANEL -->
<div id="shopPanel" class="card hidden">
<h3>Shop Panel</h3>
<input id="shopName" placeholder="Shop Name">
<button onclick="createShop()">Create Shop</button>

<h4>Add Product</h4>
<input id="pname" placeholder="Product Name">
<input id="pprice" type="number" placeholder="Price">
<button onclick="addProduct()">Add Product</button>
</div>

<!-- CUSTOMER PANEL -->
<div id="customerPanel" class="card hidden">
<h3>Customer Panel</h3>
<select id="shopSelect"></select>
<div id="productList"></div>
<h4>Total: â‚¹<span id="total">0</span></h4>
<button onclick="placeOrder()">Place Order</button>
</div>

<!-- DELIVERY PANEL -->
<div id="deliveryPanel" class="card hidden">
<h3>Delivery Panel</h3>
<div id="deliveryOrders"></div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="card hidden">
<h3>Admin Dashboard</h3>
<div id="adminStats"></div>
</div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser=null;
let cart=[];
let total=0;

function register(){
 auth.createUserWithEmailAndPassword(email.value,password.value)
 .then(()=> alert("Registered"));
}

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(user=>{
   currentUser=user.user;
   document.getElementById("dashboard").classList.remove("hidden");
   showRolePanel();
 });
}

function showRolePanel(){
 let r=role.value;
 document.getElementById("shopPanel").classList.add("hidden");
 document.getElementById("customerPanel").classList.add("hidden");
 document.getElementById("deliveryPanel").classList.add("hidden");
 document.getElementById("adminPanel").classList.add("hidden");

 if(r==="shop") document.getElementById("shopPanel").classList.remove("hidden");
 if(r==="customer"){ document.getElementById("customerPanel").classList.remove("hidden"); loadShops();}
 if(r==="delivery"){ document.getElementById("deliveryPanel").classList.remove("hidden"); loadOrders();}
 if(r==="admin"){ document.getElementById("adminPanel").classList.remove("hidden"); loadAdmin();}
}

function createShop(){
 db.collection("shops").add({
   name:shopName.value,
   owner:currentUser.uid
 });
 alert("Shop Created");
}

function addProduct(){
 db.collection("products").add({
   shop:shopName.value,
   name:pname.value,
   price:parseInt(pprice.value)
 });
 alert("Product Added");
}

function loadShops(){
 db.collection("shops").onSnapshot(snapshot=>{
   shopSelect.innerHTML="";
   snapshot.forEach(doc=>{
     shopSelect.innerHTML+=`<option>${doc.data().name}</option>`;
   });
   loadProducts();
 });
}

shopSelect?.addEventListener("change",loadProducts);

function loadProducts(){
 db.collection("products")
 .where("shop","==",shopSelect.value)
 .onSnapshot(snapshot=>{
   productList.innerHTML="";
   snapshot.forEach(doc=>{
     let p=doc.data();
     productList.innerHTML+=`
     <div class="card">
       ${p.name} - â‚¹${p.price}
       <button onclick="addToCart('${p.name}',${p.price})">Add</button>
     </div>`;
   });
 });
}

function addToCart(name,price){
 cart.push({name,price});
 total+=price;
 document.getElementById("total").innerText=total;
}

function placeOrder(){
 let commission=total*0.05;
 db.collection("orders").add({
   customer:currentUser.uid,
   shop:shopSelect.value,
   total:total,
   commission:commission,
   status:"Pending",
   timestamp:Date.now()
 });
 alert("Order Placed");
 cart=[]; total=0;
 document.getElementById("total").innerText=0;
}

function loadOrders(){
 db.collection("orders")
 .where("status","==","Pending")
 .onSnapshot(snapshot=>{
   deliveryOrders.innerHTML="";
   snapshot.forEach(doc=>{
     let o=doc.data();
     deliveryOrders.innerHTML+=`
     <div class="card">
       â‚¹${o.total}
       <button onclick="deliver('${doc.id}')">Mark Delivered</button>
       <button onclick="trackLocation('${doc.id}')">Start GPS</button>
     </div>`;
   });
 });
}

function deliver(id){
 db.collection("orders").doc(id).update({status:"Delivered"});
}

function trackLocation(orderId){
 navigator.geolocation.watchPosition(position=>{
   db.collection("orders").doc(orderId).update({
     deliveryLocation:{
       lat:position.coords.latitude,
       lng:position.coords.longitude
     }
   });
 });
 alert("GPS Tracking Started");
}

function loadAdmin(){
 db.collection("orders").onSnapshot(snapshot=>{
   let revenue=0,commission=0;
   snapshot.forEach(doc=>{
     revenue+=doc.data().total;
     commission+=doc.data().commission;
   });
   adminStats.innerHTML=`
   Total Revenue: â‚¹${revenue}<br>
   Commission Earned: â‚¹${commission}`;
 });
}
</script>

</body>
  </html>
