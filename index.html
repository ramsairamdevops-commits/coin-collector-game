<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kirana Startup App</title>
<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:0}
header{background:#2e7d32;color:white;padding:15px;text-align:center}
.container{padding:20px}
input,select{padding:8px;margin:5px;width:95%}
button{padding:10px;background:#2e7d32;color:white;border:none;cursor:pointer}
.card{background:white;padding:15px;margin:10px 0;border-radius:8px}
.hidden{display:none}
</style>
</head>
<body>

<header>
<h2>Kirana Local Shop App</h2>
</header>

<div class="container">

<!-- LOGIN / REGISTER -->
<div id="authSection">
<h3>Login / Register</h3>
<input type="text" id="mobile" placeholder="Mobile Number">
<input type="password" id="password" placeholder="Password">
<select id="role">
<option value="customer">Customer</option>
<option value="shop">Shop Owner</option>
<option value="admin">Admin</option>
</select>
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
</div>

<!-- CUSTOMER DASHBOARD -->
<div id="customerSection" class="hidden">
<h3>Customer Dashboard</h3>
<div id="shopList"></div>
<h4>Cart</h4>
<div id="cart"></div>
<button onclick="placeOrder()">Place Order</button>
<button onclick="logout()">Logout</button>
</div>

<!-- SHOP OWNER DASHBOARD -->
<div id="shopSection" class="hidden">
<h3>Shop Owner Dashboard</h3>
<input type="text" id="shopName" placeholder="Shop Name">
<button onclick="saveShop()">Save Shop</button>

<h4>Add Product</h4>
<input type="text" id="productName" placeholder="Product Name">
<input type="number" id="productPrice" placeholder="Price">
<button onclick="addProduct()">Add Product</button>

<h4>Your Products</h4>
<div id="productList"></div>
<button onclick="logout()">Logout</button>
</div>

<!-- ADMIN DASHBOARD -->
<div id="adminSection" class="hidden">
<h3>Admin Dashboard</h3>
<h4>All Orders</h4>
<div id="orderList"></div>
<h4>Total Commission Earned (5%)</h4>
<div id="commission"></div>
<button onclick="logout()">Logout</button>
</div>

</div>

<script>

let currentUser=null;
let cart=[];

// Load storage
let users=JSON.parse(localStorage.getItem("users"))||[];
let shops=JSON.parse(localStorage.getItem("shops"))||[];
let products=JSON.parse(localStorage.getItem("products"))||[];
let orders=JSON.parse(localStorage.getItem("orders"))||[];

// Register
function register(){
let mobile=document.getElementById("mobile").value;
let password=document.getElementById("password").value;
let role=document.getElementById("role").value;

if(!mobile || !password){alert("Fill all fields");return;}

users.push({mobile,password,role});
localStorage.setItem("users",JSON.stringify(users));
alert("Registered Successfully");
}

// Login
function login(){
let mobile=document.getElementById("mobile").value;
let password=document.getElementById("password").value;

let user=users.find(u=>u.mobile===mobile && u.password===password);

if(!user){alert("Invalid Login");return;}

currentUser=user;
document.getElementById("authSection").classList.add("hidden");

if(user.role==="customer"){
document.getElementById("customerSection").classList.remove("hidden");
loadShops();
}
else if(user.role==="shop"){
document.getElementById("shopSection").classList.remove("hidden");
loadProducts();
}
else{
document.getElementById("adminSection").classList.remove("hidden");
loadOrders();
}
}

// Logout
function logout(){
location.reload();
}

// Save shop
function saveShop(){
let name=document.getElementById("shopName").value;
shops.push({owner:currentUser.mobile,name});
localStorage.setItem("shops",JSON.stringify(shops));
alert("Shop Saved");
}

// Add product
function addProduct(){
let name=document.getElementById("productName").value;
let price=document.getElementById("productPrice").value;

products.push({owner:currentUser.mobile,name,price});
localStorage.setItem("products",JSON.stringify(products));
loadProducts();
}

// Load products
function loadProducts(){
let list=document.getElementById("productList");
list.innerHTML="";
products.filter(p=>p.owner===currentUser.mobile)
.forEach(p=>{
list.innerHTML+=`<div class='card'>${p.name} - ₹${p.price}</div>`;
});
}

// Load shops for customer
function loadShops(){
let list=document.getElementById("shopList");
list.innerHTML="";
shops.forEach(s=>{
let shopProducts=products.filter(p=>p.owner===s.owner);
let html=`<div class='card'><h4>${s.name}</h4>`;
shopProducts.forEach(p=>{
html+=`${p.name} - ₹${p.price} 
<button onclick="addToCart('${p.name}',${p.price})">Add</button><br>`;
});
html+="</div>";
list.innerHTML+=html;
});
}

// Add to cart
function addToCart(name,price){
cart.push({name,price});
document.getElementById("cart").innerHTML+=
`<div>${name} - ₹${price}</div>`;
}

// Place order
function placeOrder(){
if(cart.length===0){alert("Cart Empty");return;}

let total=cart.reduce((sum,i)=>sum+parseInt(i.price),0);
let commission=total*0.05;

orders.push({
customer:currentUser.mobile,
items:cart,
total,
commission
});

localStorage.setItem("orders",JSON.stringify(orders));
alert("Order Placed Successfully");
cart=[];
document.getElementById("cart").innerHTML="";
}

// Load orders for admin
function loadOrders(){
let list=document.getElementById("orderList");
let totalCommission=0;
list.innerHTML="";
orders.forEach(o=>{
list.innerHTML+=`<div class='card'>
Customer: ${o.customer}<br>
Total: ₹${o.total}<br>
Commission: ₹${o.commission}
</div>`;
totalCommission+=o.commission;
});
document.getElementById("commission").innerHTML="₹"+totalCommission;
}

</script>

</body>
</html>
