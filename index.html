<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kirana Super App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
font-family:Arial;
margin:0;
background:#f2f2f2;
}
header{
background:#1b5e20;
color:white;
padding:15px;
text-align:center;
}
.container{
padding:15px;
}
input,button{
padding:8px;
margin:5px 0;
width:100%;
box-sizing:border-box;
}
button{
background:#1b5e20;
color:white;
border:none;
cursor:pointer;
}
.card{
background:white;
padding:10px;
margin:10px 0;
border-radius:8px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
img{
width:100%;
height:150px;
object-fit:cover;
border-radius:6px;
}
.flex{
display:flex;
gap:10px;
}
.hidden{display:none;}
.qty-btn{
width:30px;
}
</style>
</head>
<body>

<header>
<h2>Kirana Super App</h2>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginSection">
<h3>Shop Owner Login</h3>
<input type="password" id="shopPass" placeholder="Enter Shop Password">
<button onclick="login()">Login</button>
</div>

<!-- SHOP DASHBOARD -->
<div id="shopSection" class="hidden">
<h3>Add / Update Product</h3>

<input type="text" id="productName" placeholder="Product Name">
<input type="number" id="productPrice" placeholder="Price">
<input type="file" id="productImage">

<img id="preview" class="hidden">

<button onclick="saveProduct()">Save Product</button>
<hr>
<h3>Your Products</h3>
<div id="shopProducts"></div>
<button onclick="logout()">Logout</button>
</div>

<hr>

<!-- CUSTOMER VIEW -->
<h3>Customer View</h3>
<div id="customerProducts"></div>

<h3>Cart</h3>
<div id="cart"></div>
<h4 id="totalAmount"></h4>

</div>

<script>

let products = JSON.parse(localStorage.getItem("products")) || [];
let cart = [];
let editIndex = -1;

// LOGIN (simple password demo)
function login(){
let pass = document.getElementById("shopPass").value;
if(pass==="1234"){
document.getElementById("loginSection").classList.add("hidden");
document.getElementById("shopSection").classList.remove("hidden");
loadShopProducts();
}
else{
alert("Wrong Password");
}
}

function logout(){
location.reload();
}

// IMAGE PREVIEW
document.getElementById("productImage").addEventListener("change", function(){
let file = this.files[0];
let reader = new FileReader();
reader.onload = function(e){
let preview = document.getElementById("preview");
preview.src = e.target.result;
preview.classList.remove("hidden");
}
reader.readAsDataURL(file);
});

// SAVE PRODUCT
function saveProduct(){
let name = document.getElementById("productName").value;
let price = document.getElementById("productPrice").value;
let image = document.getElementById("preview").src;

if(!name || !price || !image){
alert("Fill all fields");
return;
}

let product = {name,price,image};

if(editIndex === -1){
products.push(product);
}else{
products[editIndex] = product;
editIndex = -1;
}

localStorage.setItem("products", JSON.stringify(products));

clearForm();
loadShopProducts();
loadCustomerProducts();
}

function clearForm(){
document.getElementById("productName").value="";
document.getElementById("productPrice").value="";
document.getElementById("preview").classList.add("hidden");
}

// SHOP VIEW
function loadShopProducts(){
let list = document.getElementById("shopProducts");
list.innerHTML="";
products.forEach((p,index)=>{
list.innerHTML += `
<div class="card">
<img src="${p.image}">
<h4>${p.name}</h4>
<p>₹${p.price}</p>
<button onclick="editProduct(${index})">Edit</button>
<button onclick="deleteProduct(${index})">Delete</button>
</div>`;
});
}

function editProduct(index){
let p = products[index];
document.getElementById("productName").value = p.name;
document.getElementById("productPrice").value = p.price;
document.getElementById("preview").src = p.image;
document.getElementById("preview").classList.remove("hidden");
editIndex = index;
}

function deleteProduct(index){
products.splice(index,1);
localStorage.setItem("products", JSON.stringify(products));
loadShopProducts();
loadCustomerProducts();
}

// CUSTOMER VIEW
function loadCustomerProducts(){
let list = document.getElementById("customerProducts");
list.innerHTML="";
products.forEach((p,index)=>{
list.innerHTML += `
<div class="card">
<img src="${p.image}">
<h4>${p.name}</h4>
<p>₹${p.price}</p>
<button onclick="addToCart(${index})">Add to Cart</button>
</div>`;
});
}

function addToCart(index){
let product = products[index];
let existing = cart.find(c=>c.name===product.name);

if(existing){
existing.qty +=1;
}else{
cart.push({...product, qty:1});
}
renderCart();
}

function renderCart(){
let list = document.getElementById("cart");
let total = 0;
list.innerHTML="";

cart.forEach((c,i)=>{
total += c.price * c.qty;
list.innerHTML += `
<div class="card">
<img src="${c.image}">
<h4>${c.name}</h4>
<div class="flex">
<button class="qty-btn" onclick="changeQty(${i},-1)">-</button>
<span>${c.qty}</span>
<button class="qty-btn" onclick="changeQty(${i},1)">+</button>
</div>
<p>₹${c.price * c.qty}</p>
</div>`;
});

document.getElementById("totalAmount").innerText="Total: ₹"+total;
}

function changeQty(index,change){
cart[index].qty += change;
if(cart[index].qty<=0){
cart.splice(index,1);
}
renderCart();
}

loadCustomerProducts();

</script>

</body>
</html>
