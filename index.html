<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kirana Startup App</title>
<style>
body{font-family:Arial;margin:0;background:#f2f2f2}
header{background:#1b5e20;color:white;padding:15px;text-align:center}
.container{padding:20px}
input,select{padding:10px;margin:5px 0;width:100%;box-sizing:border-box}
button{padding:10px;margin:5px 0;background:#1b5e20;color:white;border:none;cursor:pointer;width:100%}
.card{background:white;padding:10px;margin:10px 0;border-radius:6px}
.hidden{display:none}
h3{margin-top:0}
</style>
</head>
<body>

<header>
<h2>Kirana Local Shop Startup</h2>
</header>

<div class="container">

<!-- AUTH SECTION -->
<div id="authSection">
<h3>Login / Register</h3>
<input type="text" id="mobile" placeholder="Mobile Number">
<input type="password" id="password" placeholder="Password">
<select id="role">
<option value="customer">Customer</option>
<option value="shop">Shop Owner</option>
<option value="admin">Admin</option>
</select>
<button onclick="registerUser()">Register</button>
<button onclick="loginUser()">Login</button>
</div>

<!-- CUSTOMER DASHBOARD -->
<div id="customerSection" class="hidden">
<h3>Customer Dashboard</h3>
<div id="shopList"></div>
<h4>Cart</h4>
<div id="cart"></div>
<button onclick="placeOrder()">Place Order</button>
<button onclick="logout()">Logout</button>
</div>

<!-- SHOP DASHBOARD -->
<div id="shopSection" class="hidden">
<h3>Shop Owner Dashboard</h3>
<input type="text" id="shopName" placeholder="Enter Shop Name">
<button onclick="saveShop()">Save Shop</button>

<h4>Add Product</h4>
<input type="text" id="productName" placeholder="Product Name">
<input type="number" id="productPrice" placeholder="Price">
<button onclick="addProduct()">Add Product</button>

<h4>Your Products</h4>
<div id="productList"></div>
<button onclick="logout()">Logout</button>
</div>

<!-- ADMIN DASHBOARD -->
<div id="adminSection" class="hidden">
<h3>Admin Dashboard</h3>
<div id="orderList"></div>
<h4>Total Commission (5%)</h4>
<div id="commissionTotal"></div>
<button onclick="logout()">Logout</button>
</div>

</div>

<script>

// ===== INITIAL DATA LOAD =====
let users = JSON.parse(localStorage.getItem("users")) || [];
let shops = JSON.parse(localStorage.getItem("shops")) || [];
let products = JSON.parse(localStorage.getItem("products")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];
let currentUser = null;
let cart = [];

// Create default admin if not exists
if(!users.find(u => u.role === "admin")){
users.push({mobile:"9999", password:"admin", role:"admin"});
localStorage.setItem("users", JSON.stringify(users));
}

// ===== REGISTER =====
function registerUser(){
let mobile = document.getElementById("mobile").value.trim();
let password = document.getElementById("password").value.trim();
let role = document.getElementById("role").value;

if(mobile==="" || password===""){
alert("Please fill all fields");
return;
}

if(users.find(u => u.mobile === mobile)){
alert("User already exists");
return;
}

users.push({mobile,password,role});
localStorage.setItem("users", JSON.stringify(users));

alert("Registration Successful! Now Login.");
}

// ===== LOGIN =====
function loginUser(){
let mobile = document.getElementById("mobile").value.trim();
let password = document.getElementById("password").value.trim();

let user = users.find(u => u.mobile === mobile && u.password === password);

if(!user){
alert("Invalid mobile or password");
return;
}

currentUser = user;

document.getElementById("authSection").classList.add("hidden");

if(user.role === "customer"){
document.getElementById("customerSection").classList.remove("hidden");
loadShops();
}
else if(user.role === "shop"){
document.getElementById("shopSection").classList.remove("hidden");
loadProducts();
}
else{
document.getElementById("adminSection").classList.remove("hidden");
loadOrders();
}
}

// ===== LOGOUT =====
function logout(){
location.reload();
}

// ===== SHOP FUNCTIONS =====
function saveShop(){
let name = document.getElementById("shopName").value.trim();
if(name===""){alert("Enter shop name");return;}

shops.push({owner:currentUser.mobile,name});
localStorage.setItem("shops", JSON.stringify(shops));
alert("Shop Saved");
}

function addProduct(){
let name = document.getElementById("productName").value.trim();
let price = document.getElementById("productPrice").value;

if(name==="" || price===""){alert("Fill product details");return;}

products.push({owner:currentUser.mobile,name,price});
localStorage.setItem("products", JSON.stringify(products));
loadProducts();
}

function loadProducts(){
let list = document.getElementById("productList");
list.innerHTML="";
products.filter(p => p.owner === currentUser.mobile)
.forEach(p=>{
list.innerHTML += `<div class="card">${p.name} - ₹${p.price}</div>`;
});
}

// ===== CUSTOMER FUNCTIONS =====
function loadShops(){
let list = document.getElementById("shopList");
list.innerHTML="";

shops.forEach(s=>{
let shopProducts = products.filter(p=>p.owner===s.owner);

let html = `<div class="card"><h4>${s.name}</h4>`;

shopProducts.forEach(p=>{
html += `${p.name} - ₹${p.price}
<button onclick="addToCart('${p.name}',${p.price})">Add</button><br>`;
});

html += "</div>";
list.innerHTML += html;
});
}

function addToCart(name,price){
cart.push({name,price});
document.getElementById("cart").innerHTML += 
`<div>${name} - ₹${price}</div>`;
}

function placeOrder(){
if(cart.length===0){
alert("Cart is empty");
return;
}

let total = cart.reduce((sum,item)=>sum+parseInt(item.price),0);
let commission = total * 0.05;

orders.push({
customer:currentUser.mobile,
items:cart,
total,
commission
});

localStorage.setItem("orders", JSON.stringify(orders));

alert("Order placed successfully!");
cart=[];
document.getElementById("cart").innerHTML="";
}

// ===== ADMIN FUNCTIONS =====
function loadOrders(){
let list = document.getElementById("orderList");
let totalCommission = 0;
list.innerHTML="";

orders.forEach(o=>{
list.innerHTML += `
<div class="card">
Customer: ${o.customer}<br>
Total: ₹${o.total}<br>
Commission: ₹${o.commission}
</div>`;
totalCommission += o.commission;
});

document.getElementById("commissionTotal").innerHTML = "₹" + totalCommission;
}

</script>

</body>
</html>
