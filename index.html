<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EchoSoul Anonymous</title>

<style>
body{
  font-family:Arial;
  margin:0;
  background:#0f172a;
  color:white;
}
.container{
  max-width:600px;
  margin:auto;
  padding:20px;
}
.card{
  background:#1e293b;
  padding:20px;
  border-radius:15px;
  margin-bottom:20px;
}
input,select,textarea,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
button{
  background:#6366f1;
  color:white;
  font-weight:bold;
}
.hidden{display:none;}
.feed-item{
  background:#334155;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
}
.badge{
  padding:5px 10px;
  border-radius:20px;
  font-size:12px;
}
.admin-badge{ background:gold; color:black; }
.user-badge{ background:gray; }
.delete-btn{
  background:red;
  margin-top:5px;
}
</style>
</head>

<body>

<div class="container">

<h2>EchoSoul üîê Anonymous</h2>

<!-- LOGIN / REGISTER -->
<div id="authCard" class="card">
<h3>Register</h3>
<input id="regName" placeholder="Full Name">
<select id="regType">
<option value="email">Email</option>
<option value="phone">Phone</option>
</select>
<input id="regIdentifier" placeholder="Email or Phone">
<input id="regPassword" type="password" placeholder="Password">
<button onclick="register()">Register</button>

<hr>

<h3>Login</h3>
<input id="loginIdentifier" placeholder="Email or Phone">
<input id="loginPassword" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden">

<div class="card">
<p id="welcome"></p>
<span id="roleBadge"></span>
<button onclick="logout()">Logout</button>
</div>

<div class="card">
<h3>Create Anonymous Post</h3>
<textarea id="postText" placeholder="Write something..."></textarea>
<button onclick="createPost()">Post</button>
</div>

<div class="card">
<h3>Public Feed</h3>
<div id="feed"></div>
</div>

</div>

</div>

<script>

let currentUserID=null;
let currentRole="user";

// üëë DEFINE ADMIN LOGIN HERE
const ADMIN_IDENTIFIER="admin@gmail.com";
const ADMIN_PASSWORD="admin123";

// REGISTER
function register(){
  let name=document.getElementById("regName").value;
  let identifier=document.getElementById("regIdentifier").value;
  let password=document.getElementById("regPassword").value;

  if(name===""||identifier===""||password===""){
    alert("Fill all details");
    return;
  }

  let users=JSON.parse(localStorage.getItem("users")||"[]");

  if(users.find(u=>u.identifier===identifier)){
    alert("User already exists");
    return;
  }

  let userID="user_"+Math.random().toString(36).substring(2,9);

  users.push({
    userID:userID,
    name:name,
    identifier:identifier,
    password:password
  });

  localStorage.setItem("users",JSON.stringify(users));

  alert("Registration successful");
}

// LOGIN
function login(){
  let identifier=document.getElementById("loginIdentifier").value;
  let password=document.getElementById("loginPassword").value;

  // Admin Login
  if(identifier===ADMIN_IDENTIFIER && password===ADMIN_PASSWORD){
    currentUserID="admin";
    currentRole="admin";
    localStorage.setItem("session","admin");
    openApp();
    return;
  }

  let users=JSON.parse(localStorage.getItem("users")||"[]");

  let user=users.find(u=>u.identifier===identifier && u.password===password);

  if(!user){
    alert("Invalid login");
    return;
  }

  currentUserID=user.userID;
  currentRole="user";

  localStorage.setItem("session",currentUserID);

  openApp();
}

function openApp(){
  document.getElementById("authCard").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");

  if(currentRole==="admin"){
    document.getElementById("welcome").innerText="Welcome Admin";
    document.getElementById("roleBadge").innerHTML="<span class='badge admin-badge'>Admin</span>";
  }else{
    document.getElementById("welcome").innerText="Welcome User";
    document.getElementById("roleBadge").innerHTML="<span class='badge user-badge'>User</span>";
  }

  renderFeed();
}

// LOGOUT
function logout(){
  localStorage.removeItem("session");
  location.reload();
}

// CREATE POST (ANONYMOUS)
function createPost(){
  let text=document.getElementById("postText").value;
  if(text===""){return;}

  let posts=JSON.parse(localStorage.getItem("posts")||"[]");

  posts.push({
    ownerID:currentUserID, // internal only
    text:text,
    createdAt:new Date()
  });

  localStorage.setItem("posts",JSON.stringify(posts));
  document.getElementById("postText").value="";
  renderFeed();
}

// RENDER FEED (NO IDENTITY SHOWN)
function renderFeed(){
  let posts=JSON.parse(localStorage.getItem("posts")||"[]");
  let feed=document.getElementById("feed");
  feed.innerHTML="";

  posts.slice().reverse().forEach((p,index)=>{
    feed.innerHTML+=`
      <div class="feed-item">
        <b>Anonymous</b>: ${p.text}
        ${currentRole==="admin" ? 
          `<button class="delete-btn" onclick="deletePost(${posts.length-1-index})">Delete</button>` 
          : ""}
      </div>
    `;
  });
}

// DELETE (ADMIN ONLY)
function deletePost(index){
  let posts=JSON.parse(localStorage.getItem("posts")||"[]");
  posts.splice(index,1);
  localStorage.setItem("posts",JSON.stringify(posts));
  renderFeed();
}

// AUTO LOGIN
window.onload=function(){
  let session=localStorage.getItem("session");
  if(session){
    if(session==="admin"){
      currentUserID="admin";
      currentRole="admin";
    }else{
      currentUserID=session;
      currentRole="user";
    }
    openApp();
  }
}

</script>

</body>
</html>
