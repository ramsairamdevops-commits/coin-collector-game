<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EchoWeave: Emotion Contagion</title>
<style>
body {margin:0; font-family:sans-serif; background:#222; color:#fff;}
#gameArea {position:relative; width:100vw; height:80vh; background:#333; overflow:hidden;}
.villager {
  width:30px; height:30px; border-radius:50%; position:absolute;
  text-align:center; line-height:30px; font-weight:bold;
  color:#000; cursor:pointer;
}
button {margin:5px; padding:10px; font-size:16px; border:none; border-radius:8px; cursor:pointer;}
</style>
</head>
<body>
<h1>EchoWeave: Emotion Contagion Village</h1>
<div>
<button onclick="build('house')">Build House</button>
<button onclick="build('entertainment')">Build Entertainment</button>
<button onclick="build('workplace')">Build Workplace</button>
</div>
<div id="gameArea"></div>
<div id="score">Score: 0 | Happiness: 50%</div>

<script>
const gameArea = document.getElementById('gameArea');
let villagers = [];
let buildings = [];
let score = 0;

// VILLAGER EMOTIONS
const moods = ['happy','neutral','sad','angry'];
const moodColors = {happy:'yellow',neutral:'gray',sad:'blue',angry:'red'};

// SPAWN INITIAL VILLAGERS
for(let i=0;i<10;i++){
  spawnVillager();
}

function spawnVillager(){
  const v=document.createElement('div');
  v.className='villager';
  v.style.left=Math.random()*(window.innerWidth-30)+'px';
  v.style.top=Math.random()*(window.innerHeight*0.8-30)+'px';
  v.dataset.mood = moods[Math.floor(Math.random()*moods.length)];
  v.style.background = moodColors[v.dataset.mood];
  gameArea.appendChild(v);
  villagers.push(v);
}

// BUILDING ACTIONS
function build(type){
  buildings.push({type, time:Date.now()});
  // Affect villagers based on type
  villagers.forEach(v=>{
    if(type==='house' && v.dataset.mood!=='happy') setMood(v,'neutral');
    if(type==='entertainment') setMood(v,'happy');
    if(type==='workplace' && v.dataset.mood==='happy') setMood(v,'neutral');
  });
  updateScore();
}

function setMood(v, mood){
  v.dataset.mood = mood;
  v.style.background = moodColors[mood];
}

// EMOTION CONTAGION: Every 2 sec
setInterval(()=>{
  villagers.forEach(v=>{
    let neighbors = villagers.filter(n=>n!==v);
    neighbors.forEach(n=>{
      if(n.dataset.mood==='happy' && Math.random()<0.1) setMood(v,'happy');
      if(n.dataset.mood==='angry' && Math.random()<0.05) setMood(v,'angry');
    });
  });
  updateScore();
},2000);

// UPDATE SCORE AND HAPPINESS
function updateScore(){
  let happyCount = villagers.filter(v=>v.dataset.mood==='happy').length;
  let happiness = Math.round(happyCount/villagers.length*100);
  score += happyCount;
  document.getElementById('score').innerText = `Score: ${score} | Happiness: ${happiness}%`;
}
</script>
</body>
</html>
